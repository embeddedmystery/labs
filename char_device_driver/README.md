# simple character device driver

- **Create a simple module**
  - Write init() and exit() functions
  - Create *Kbuild* and *Makefile*
  - Build program by running `make`
  - Insert module using `insmod`
  - Check output of `dmesg` and `lsmod`
  - Remove module using `rmmod` and check `dmesg`/`lsmod` output
  - Reference code: [click here](https://github.com/embeddedmystery/labs/tree/1cbd5a024a957938a18ccaef8b905a30520320bd/char_device_driver)
- **Create a device file**
  - What is device major and minor number?
  - Create a character device file using `mknod`
  - Read device file using `cat`
  - Write to device file using `echo`
  - Notice the error/message and `dmesg` output for both read/write
- **Convert module to character device driver**
  - Call `register_chardev()` from init() function
  - `register_chardev()` arguments? - research! (Hint: check *linux/fs.h*)
  - Call `unregister_chardev()` from exit() function
  - Build and `insmod`
  - Check `dmesg` output
  - Read/write to device file and check `dmesg` output
  - `rmmod` and check `dmesg` output
  - Reference code: [click here](https://github.com/embeddedmystery/labs/tree/cef3ceb3c9397fd9d0ff13cb4f4bdfa7dab521f7/char_device_driver)
- **Add open() and release() functions**
  - Write empty open() and release() functions (function signatures? Hint: *linux/fs.h*)
  - Initialize `file_operations` object with both functionâ€™s pointer
  - Build, `insmod` and check `dmesg` output
  - Read/write to device file and check `dmesg` output
  - `rmmod` and check `dmesg` output
  - Reference code: [click here](https://github.com/embeddedmystery/labs/tree/a203b4bf94cc5b6903f7be57e0cc2ad9302da45e/char_device_driver)
- **Print device major and minor number in open()/release() functions**
  - Find how to get the device number from `inode` object
  - Reference code: [click here](https://github.com/embeddedmystery/labs/tree/5c1cd32e4069ed677fac1f7dabb74db41f0c744d/char_device_driver)
- **Add read() and write() functions**
  - Write empty read() and write() functions and update `file_operations` object
  - Build, `insmod` and check `dmesg` output
  - Read/write to device file and check `dmesg` output
  - Reference code: [click here](https://github.com/embeddedmystery/labs/tree/3ad73de6f36e9eae709520f792d6adebcb391e9b/char_device_driver)
- **Any issue?**
  - Why does `echo` never return?
  - Fix it (Hint: return `count` from write())
  - Reference code: [click here](https://github.com/embeddedmystery/labs/tree/0b581235eb5c83f8e8e726ef7c12cfb6e42202d3/char_device_driver)
- **Print device major and minor in read()/write functions**
  - Find how to get the device number from `file` object
  - Reference code: [click here](https://github.com/embeddedmystery/labs/tree/a0f4bbe5232597d65e10f190b816968298dbab99/char_device_driver)
- **Read data from user**
  - Use `copy_from_user()` function to read user buffer (signature? Hint: *linux/uaccess.h*)
  - Store this data and data length in some global variable and print it
  - Build and run
  - Reference code: [click here](https://github.com/embeddedmystery/labs/tree/e65ddaf6096e8f8b0b5ef1cfaef79270893aaa88/char_device_driver)
- **Send data to user**
  - Use `copy_to_user()` function to write data to user buffer
  - Copy previously stored data to user buffer
  - Build and run
  - Reference code: [click here](https://github.com/embeddedmystery/labs/tree/b50bb8623fb9691ba5e35bd87bf6609cd3706183/char_device_driver)
- **Any issue?**
  - Why does `cat` print nothing?
  - Fix it (Hint: return data length from read())
  - Reference code: [click here](https://github.com/embeddedmystery/labs/tree/54ed2288b52bc06f55539619c609ab538072b13d/char_device_driver)
- **Any issue?**
  - Why does `cat` get stuck in an infinite loop?
  - Fix it (Hint: return `0` once data is read)
  - Reference code: [click here](https://github.com/embeddedmystery/labs/tree/9707a2e76c48967b9f45dc500d9f395f1543963d/char_device_driver)
- **Convert code to store 10 lines from user**
  - Modify data buffer to store 10 lines
  - Return only one line at a time while reading from the device and return `0` once all lines are read
  - Return lines in reverse chronological order i.e. latest line first
  - Reference code: [click here](https://github.com/embeddedmystery/labs/tree/8639b66f2ce0556410adc2c6300ecfd4eb49b4ef/char_device_driver)
- **Any issue?**
  - What will happen when the buffer is full?
  - Fix it (Hint: convert it to a circular buffer)
